# Week 14：可观测性进阶与异步任务

## 本周目标

建立“日志 + 指标 + 链路追踪”三位一体排障能力，并补齐异步任务的可靠执行机制。

## 详细步骤

1. 接入 OpenTelemetry，完成基础 Trace 上报。
2. 为核心链路补齐 Trace Span（登录、创建 Todo、查询 Todo、完成 Todo）。
3. 定义最小 SLI/SLO（可用性、P95 延迟、错误率）及告警阈值。
4. 构建基础观测看板（请求量、错误率、延迟分位、缓存命中率）。
5. 实现一个异步任务场景（如 Todo 完成后发送通知）。
6. 设计并落地任务重试与失败记录机制（重试次数、失败原因、最终状态）。
7. 为关键安全行为补审计日志（登录成功/失败、权限拒绝、关键写操作）。
8. 做一次全链路排障演练（从告警到定位再到修复），输出复盘。

## 建议实践清单

- Trace 与日志都带 `request_id`，便于互相跳转定位。
- SLO 先从保守目标开始，再按真实负载迭代。
- 异步任务要可重放，避免一次失败就永久丢失。
- 观测面板优先覆盖“是否可用、是否变慢、是否错误变多”三类问题。

## 验收清单

- [ ] 核心接口可在追踪系统中看到完整链路。
- [ ] 已定义并记录 SLI/SLO 与告警规则。
- [ ] 至少 1 个异步任务支持重试与失败可追踪。
- [ ] 审计日志覆盖登录与关键写操作。
- [ ] 完成一次全链路故障排查演练并形成复盘。

## 产出物

- Trace 接入代码与链路追踪说明文档。
- SLI/SLO 与告警策略文档。
- 异步任务实现代码、测试与运行说明。
- 审计日志规范与一次排障复盘报告。

## 常见风险与排查

- 只有日志没有 Trace：跨服务定位会非常慢，必须补链路追踪。
- 只做看板不设告警：问题无法被及时发现。
- 异步任务无幂等：重试可能造成重复副作用。
- 失败任务只打印日志不落库：后续无法补偿与追溯。
